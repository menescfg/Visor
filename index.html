<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Preliminar SIG - Tesis</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="header"><b>Preliminar SIG (Tesis)</b> · Público (demo) · El Salvador</div>
  <div id="map"></div>

  <script>
    // Inicializar mapa
    const map = L.map('map', { zoomControl: true }).setView([13.70, -89.19], 12);

    // Capas base
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      maxZoom: 19, attribution: 'Tiles &copy; Esri'
    });

    // Contenedores de capas de datos
    const puntosLayer = L.layerGroup();
    const zonasLayer  = L.layerGroup();

    // Cargar puntos
    fetch('data/puntos.geojson').then(r => r.json()).then(geo => {
      const lyr = L.geoJSON(geo, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 6, fillOpacity: 0.9, color: '#333', weight: 1
          });
        },
        onEachFeature: function (feature, layer) {
          const p = feature.properties || {};
          const img = p.imagen ? `<img src="images/${p.imagen}" alt="imagen">` : '';
          const html = `<b>${p.nombre || 'Sitio'}</b><br>
                        Fuente: ${p.fuente || '-'} · Año: ${p.anio || '-'}<br>
                        ${p.descripcion || ''}${img}`;
          layer.bindPopup(html);
        }
      });
      puntosLayer.addLayer(lyr).addTo(map);
    });

    // Cargar polígonos
    fetch('data/zonas.geojson').then(r => r.json()).then(geo => {
      const lyr = L.geoJSON(geo, {
        style: function () {
          return { color: '#1f78b4', weight: 2, fillOpacity: 0.1 };
        },
        onEachFeature: function (feature, layer) {
          const p = feature.properties || {};
          layer.bindPopup(`<b>${p.nombre || 'Zona'}</b><br>Fuente: ${p.fuente || '-'}`);
        }
      });
      zonasLayer.addLayer(lyr).addTo(map);
    });

    // Overlay de imagen (opcional) — ajusta bounds a tu necesidad
    const overlay = L.imageOverlay('images/Soyapango.png', [[13.695, -89.205], [13.715, -89.175]]);
    // overlay.addTo(map); // Descomenta si quieres mostrarla sobre el mapa

    // Control de capas
    const baseMaps = { "OpenStreetMap": osm, "Esri Satélite": esri };
    const overlayMaps = { "Puntos (tesis)": puntosLayer, "Zonas de estudio": zonasLayer /*, "Perfil Soyapango": overlay */ };
    L.control.layers(baseMaps, overlayMaps, { collapsed: false, position: 'topright' }).addTo(map);

    // Escala
    L.control.scale().addTo(map);

    // Leyenda sencilla
    const legend = L.control({position: 'bottomright'});
    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML = `<b>Leyenda</b><br>
        <span style="display:inline-block;width:10px;height:10px;border:1px solid #333;border-radius:50%;background:#ccc;margin-right:6px;"></span> Puntos (pozos, sitios)<br>
        <span style="display:inline-block;width:14px;height:10px;border:2px solid #1f78b4;background:rgba(31,120,180,0.1);margin-right:6px;"></span> Zonas de estudio`;
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
